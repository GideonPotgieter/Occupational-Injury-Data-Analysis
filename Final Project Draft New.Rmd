```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r libraries, include=FALSE}
install.packages("rlang")
library(tidyverse)
library(knitr)  
library(ggpubr)
library(ggrepel)
library(tidyverse)
library(kableExtra)
library(survey)
library(haven)
library(broom)
library(plotrix)
library(patchwork)
library(pander)


# any other libraries you want to load
```

### Question of interest

What risk factors are associated with experiencing an occupational injury/illness?

### Data

For this project, I am using the Quality of Worklife (QWL) survey data, which is a part of the General Social Survey questionnaire for adults who have been employed in the United States in the past year. Here is the link to the [The General Social Survey website](https://gss.norc.org/Pages/quality-of-worklife.aspx){target="_blank"}.

Download your data and upload it into the data folder in this project. That way when we clone your repository for grading, we can knit your file.

Note: If you are using data that can't be shared publicly, please reach out to us to discuss the best way to work with your data. Do NOT upload your data to Github!

```{r data, include = FALSE}
dat <- read_sav('data/NIOSH-QWL.sav')
                
dat2014 <- dat %>% filter(year == "2014")

dat2014 <- dat2014 %>% select(race = nrace, occ = occ2, sex, age, fairearn, wkinjury)

drop_na(dat2014)

dat2014 <- dat2014 %>% mutate(occ=factor(occ, levels=c(1, 2, 3, 4, 5), labels=c('White Collar', 'Blue Collar','Service', 'Farming/Fishing/Forestry', 'Military')), 
                            race=factor(race, levels=c(0, 1, 2, 3, 4, 5), 
                      labels=c('N/A', 'White', 
                              'Black/African American', 
                              'American/Alaska Native', 
                              'Asian/Pacific Islander', 'Hispanic')))

```

```{r}
Table_1 <- dat2014 %>%
  count(wkinjury, occ) %>%
  mutate(prop = n/sum(n)) %>%
   mutate(percent =round(n/sum(n)*100,1))

Table_1 %>%
  filter(wkinjury == 1) %>%
  ggplot() +
  geom_bar(mapping = aes(x = occ, y = percent), stat = "identity") + 
   geom_text(aes(x = occ, y = percent, label = percent)) +
  labs(y= "",
       x= "",
       title= "")

Table_2 <- dat2014 %>%
  count(wkinjury, race) %>%
  mutate(prop = n/sum(n)) %>%
   mutate(percent =round(n/sum(n)*100,1))

Table_2 %>%
  filter(wkinjury == 1) %>%
  ggplot() +
  geom_bar(mapping = aes(x = race, y = percent), stat = "identity") + 
   geom_text(aes(x = race, y = percent, label = percent)) +
  labs(y= "",
       x= "",
       title= "")